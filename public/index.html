<!DOCTYPE html>
<html>
  <head>
    <title>Zilch</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
      $(() => {
        let socket = io();
        let playerNumber = null;

        // Update status
        socket.on("status", (msg) => {
          $("#status").val(msg);
        });

        socket.on("scoringOptions", (msg) => {
          $("#scoringOptions").val(msg);
        });

        // Listen to player number assignments
        socket.on("assignPlayerNumber", (number) => {
          if (playerNumber === null) {
            playerNumber = number;
            document.getElementById("playerNumber").innerHTML = playerNumber;
          }
        });

        socket.on("newDice", (dice) => {
          $("#status").val(`Status: \n${JSON.stringify(dice)}`);
          for (let i = 0; i < dice.length; i++) {
            let die = dice[i];
            const checkBox = document.getElementById(`dice${i}`);
            const label = document.getElementById(`label${i}`);
            checkBox.disabled = !die.available;
            label.innerHTML = die.value;
          }
        });

        $("#rollDice").click(() => {
          let dice = [];
          for (let i = 0; i < 6; i++) {
            const checkBox = document.getElementById(`dice${i}`);
            dice[i] = checkBox.checked;
          }
          socket.emit("rollDice", dice);
          socket.emit("scoreDice", dice);
          socket.emit("status", "Submitted roll");
        });

        $("#cashDice").click(() => {
          let dice = [];
          for (let i = 0; i < 6; i++) {
            const checkBox = document.getElementById(`dice${i}`);
            dice[i] = checkBox.checked;
          }
          socket.emit("cashDice", dice);
          socket.emit("status", "Cashed in");
        });

        $("input:checkbox").change(() => {
          console.log("change detected");
          let chosenDice = [];
          for (let i = 0; i < 6; i++) {
            const checkBox = document.getElementById(`dice${i}`);
            if (checkBox.checked && !checkBox.disabled) {
              chosenDice.push({
                value: document.getElementById(`label${i}`).innerHTML,
                available: true,
              });
            }
          }
          console.log(chosenDice);
          socket.emit("scoreDice", chosenDice);
        });
      });
    </script>
  </head>
  <body>
    Status:
    <br />
    <textarea
      rows="10"
      cols="30"
      disabled
      id="status"
      value="initial state"
    ></textarea>
    <br />
    <br />
    Scoring Options:
    <br />
    <textarea rows="10" cols="35" disabled id="scoringOptions"></textarea>
    <br />
    <br />
    <input type="checkbox" id="dice0" name="dice0" disabled />
    <label for="dice0" id="label0">Waiting to roll..</label>
    <br />
    <input type="checkbox" id="dice1" name="dice1" disabled />
    <label for="dice1" id="label1">Waiting to roll..</label>
    <br />
    <input type="checkbox" id="dice2" name="dice2" disabled />
    <label for="dice2" id="label2">Waiting to roll..</label>
    <br />
    <input type="checkbox" id="dice3" name="dice3" disabled />
    <label for="dice3" id="label3">Waiting to roll..</label>
    <br />
    <input type="checkbox" id="dice4" name="dice4" disabled />
    <label for="dice4" id="label4">Waiting to roll..</label>
    <br />
    <input type="checkbox" id="dice5" name="dice5" disabled />
    <label for="dice5" id="label5">Waiting to roll..</label>
    <br />
    <br />
    <button id="rollDice">Submit dice selection & roll dice</button>
    <br />
    <button id="cashDice">Submit dice selection & cash in dice</button>
    <br />
    <br />
    <label for="currentScore">Current turn score: </label>
    <input type="text" disabled id="currentScore" value="0" />
    <br />
    <p>Player number: <span id="playerNumber">Unassigned</span></p>
    <label for="p1Score">Player 1 score: </label>
    <input type="text" disabled id="p1Score" value="0" />
    <br />
    <label for="p2Score">Player 2 score: </label>
    <input type="text" disabled id="p2Score" value="0" />
  </body>
</html>
